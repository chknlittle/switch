flowchart TB
  %% OpenCode path (big blocks)

  Core["Session Core<br/>(SessionRuntime)"]
  Adapter["Session XMPP Adapter<br/>(SessionBot + event sink)"]

  OpenCodeRunner["OpenCodeRunner<br/>(HTTP + SSE)"]
  OpenCodeServer["External OpenCode server"]

  %% Main execution
  Core -->|run prompt| OpenCodeRunner
  OpenCodeRunner <--> |HTTP + SSE| OpenCodeServer

  %% Questions are bridged through the adapter
  OpenCodeRunner -->|question| Core
  Core -->|emit question meta| Adapter
  Adapter -->|user reply| Core
  Core -->|answer| OpenCodeRunner

  %% Results
  OpenCodeRunner -->|stream events| Core
  Core -->|emit OutboundMessage| Adapter
